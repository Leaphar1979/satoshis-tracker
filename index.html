<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Satoshis Tracker â€“ BTC Pair Trades</title>

  <!-- iPhone PWA settings -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="apple-mobile-web-app-title" content="Satoshis Tracker" />

  <!-- App Icon -->
  <link rel="icon" type="image/png" href="icon-512.png" />
  <link rel="apple-touch-icon" href="icon-512.png" />

  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 16px;
      background: #050816;
      color: #e5e7eb;
    }

    h1 {
      margin-top: 0;
      margin-bottom: 8px;
      text-align: center;
    }

    .subtitle {
      font-size: 0.85rem;
      color: #9ca3af;
      margin-bottom: 16px;
      text-align: center;
    }

    .card {
      background: #111827;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
    }

    .card h2 {
      font-size: 1.1rem;
      margin-top: 0;
      margin-bottom: 12px;
    }

    form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
    }

    label {
      font-size: 0.8rem;
      color: #9ca3af;
      display: block;
      margin-bottom: 4px;
    }

    input {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
    }

    input:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 1px #22c55e33;
    }

    button {
      padding: 8px 12px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .btn-primary {
      background: #22c55e;
      color: #022c22;
      font-weight: 600;
      width: 100%;
    }

    .btn-secondary {
      background: #1f2937;
      color: #e5e7eb;
      border: 1px solid #374151;
    }

    .summary {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      font-size: 0.85rem;
    }

    .summary-item {
      padding: 8px 12px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #1f2937;
    }

    .table-wrapper {
      width: 100%;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
    }

    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid #1f2937;
      white-space: nowrap;
      text-align: right;
    }

    th:first-child, td:first-child { text-align: left; }

    .tag-win { color: #22c55e; font-weight: 600; }
    .tag-loss { color: #f97316; font-weight: 600; }

    .footer {
      margin-top: 16px;
      font-size: 0.75rem;
      color: #6b7280;
      text-align: center;
    }

    #bankChart {
      width: 100%;
      background: #020617;
      border-radius: 8px;
    }
  </style>
</head>
<body>

  <!-- BIG ICON -->
  <div style="text-align:center; margin-bottom:10px;">
    <img src="icon-512.png" alt="logo"
         style="width:120px; height:120px; border-radius:20px;">
  </div>

  <h1>Satoshis Tracker â€“ BTC Pair Trades</h1>
  <div class="subtitle">Record your trades and track your satoshi growth.</div>

  <!-- NEW TRADE CARD -->
  <div class="card">
    <h2>New trade</h2>

    <form id="tradeForm">
      <div>
        <label for="data">Date (DD/MM/YYYY)</label>
        <input type="text" id="data" placeholder="03/12/2025" required>
      </div>

      <div>
        <label for="par">Pair</label>
        <input type="text" id="par" placeholder="XRP/BTC" required>
      </div>

      <div>
        <label for="quantidadeAlt">Alt quantity</label>
        <input type="number" step="0.00000001" id="quantidadeAlt" required>
      </div>

      <div>
        <label for="precoEntrada">Entry price (BTC)</label>
        <input type="number" step="0.00000001" id="precoEntrada" required>
      </div>

      <div>
        <label for="precoSaida">Exit price (BTC)</label>
        <input type="number" step="0.00000001" id="precoSaida" required>
      </div>

      <div>
        <label for="taxaBtc">Fee (BTC)</label>
        <input type="number" step="0.00000001" id="taxaBtc" placeholder="0 if paid in BNB">
      </div>

      <div>
        <button class="btn-primary">Add trade</button>
      </div>
    </form>
  </div>

  <!-- SUMMARY CARD -->
  <div class="card">
    <h2>Summary</h2>

    <div style="margin-bottom:12px;">
      <label for="bancaInicial">Initial bank (BTC):</label>
      <input type="number" step="0.00000001" id="bancaInicial"
             placeholder="0.0025" style="max-width:160px;">
      <button class="btn-primary" id="btnSalvarBanca"
              style="width:auto; margin-left:8px;">Save</button>
    </div>

    <div class="summary">
      <div class="summary-item" id="sumTotalTrades">Trades: 0</div>
      <div class="summary-item" id="sumWins">Win rate: 0%</div>
      <div class="summary-item" id="sumBtcResult">BTC Result: 0</div>
      <div class="summary-item" id="sumAvgRoi">Avg ROI: 0%</div>
      <div class="summary-item" id="sumBankInitial">Initial bank: â€”</div>
      <div class="summary-item" id="sumBankCurrent">Current bank: â€”</div>
      <div class="summary-item" id="sumBankGrowth">Growth: â€”</div>
    </div>

    <div style="margin-top:12px;">
      <button class="btn-secondary" id="btnToggleChart">Bank chart</button>
      <button class="btn-secondary" id="btnTogglePairs">Pairs summary</button>
    </div>
  </div>

  <!-- BANK CHART -->
  <div class="card" id="cardChart" style="display:none;">
    <h2>Bank evolution (BTC)</h2>
    <canvas id="bankChart" height="200"></canvas>
  </div>

  <!-- PAIRS SUMMARY -->
  <div class="card" id="cardPairs" style="display:none;">
    <h2>Pairs summary</h2>
    <div class="table-wrapper">
      <table id="pairsTable">
        <thead>
          <tr>
            <th>Pair</th>
            <th>Trades</th>
            <th>Wins</th>
            <th>Total BTC</th>
            <th>Avg ROI %</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- TRADE HISTORY -->
  <div class="card">
    <h2>Trade history</h2>
    <div class="table-wrapper">
      <table id="tradesTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Pair</th>
            <th>Qty</th>
            <th>Entry (BTC)</th>
            <th>Exit (BTC)</th>
            <th>BTC In</th>
            <th>BTC Out</th>
            <th>BTC Result</th>
            <th>ROI %</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="footer">
    Data stored locally (localStorage). You are farming sats. ðŸš€
  </div>

  <script>
    const STORAGE_KEY = "btcPairTrades";
    const BANK_KEY = "btcBankInitial";
    const HISTORY_KEY = "btcBankHistory";

    function loadTrades() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
      catch { return []; }
    }

    function saveTrades(t) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(t));
    }

    function loadBankInitial() {
      let v = parseFloat(localStorage.getItem(BANK_KEY));
      return isNaN(v) ? 0 : v;
    }

    function saveBankInitial(v) {
      localStorage.setItem(BANK_KEY, String(v));
    }

    function loadBankHistory() {
      try { return JSON.parse(localStorage.getItem(HISTORY_KEY) || "[]"); }
      catch { return []; }
    }

    function saveBankHistory(h) {
      localStorage.setItem(HISTORY_KEY, JSON.stringify(h));
    }

    function updateBankHistory(val) {
      const h = loadBankHistory();
      if (!h.length || h[h.length - 1].value !== val) {
        h.push({ time: new Date().toISOString(), value: val });
        saveBankHistory(h);
      }
    }

    function formatNumber(n, d = 8) { return Number(n).toFixed(d); }
    function formatPercent(n) { return Number(n).toFixed(2) + "%"; }

    function parseDate(str) {
      // DD/MM/YYYY â†’ YYYY-MM-DD
      const [d, m, y] = str.split("/");
      return `${y}-${m}-${d}`;
    }

    // ðŸ”µ MAIN RENDER FUNCTION
    function renderTrades() {
      const trades = loadTrades();
      let total = 0, wins = 0;

      const tbody = document.querySelector("#tradesTable tbody");
      tbody.innerHTML = "";

      trades.forEach((t, idx) => {
        total += t.btcResult;
        if (t.btcResult > 0) wins++;

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${t.date}</td>
          <td>${t.pair}</td>
          <td>${formatNumber(t.qty, 4)}</td>
          <td>${formatNumber(t.entry)}</td>
          <td>${formatNumber(t.exit)}</td>
          <td>${formatNumber(t.btcIn)}</td>
          <td>${formatNumber(t.btcOut)}</td>
          <td class="${t.btcResult >= 0 ? "tag-win" : "tag-loss"}">${formatNumber(t.btcResult)}</td>
          <td class="${t.roi >= 0 ? "tag-win" : "tag-loss"}">${formatPercent(t.roi)}</td>
        `;
        tbody.appendChild(row);
      });

      const totalTrades = trades.length;
      const avgROI = totalTrades ? trades.reduce((s, t) => s + t.roi, 0) / totalTrades : 0;

      document.getElementById("sumTotalTrades").textContent = `Trades: ${totalTrades}`;
      document.getElementById("sumWins").textContent = `Win rate: ${(wins / totalTrades * 100 || 0).toFixed(2)}%`;
      document.getElementById("sumBtcResult").textContent = `BTC Result: ${formatNumber(total)}`;
      document.getElementById("sumAvgRoi").textContent = `Avg ROI: ${avgROI.toFixed(2)}%`;

      // BANK
      const bankInit = loadBankInitial();
      const bankNow = bankInit + total;

      document.getElementById("sumBankInitial").textContent = `Initial bank: ${formatNumber(bankInit)}`;
      document.getElementById("sumBankCurrent").textContent = `Current bank: ${formatNumber(bankNow)}`;
      document.getElementById("sumBankGrowth").textContent =
        `Growth: ${(bankInit ? (total / bankInit * 100) : 0).toFixed(2)}%`;

      updateBankHistory(bankNow);
      renderBankChart();
      renderPairSummary();
    }

    // ðŸ”µ PAIRS SUMMARY
    function renderPairSummary() {
      const trades = loadTrades();
      const table = document.querySelector("#pairsTable tbody");
      table.innerHTML = "";

      const groups = {};

      trades.forEach(t => {
        if (!groups[t.pair]) groups[t.pair] = { trades: 0, wins: 0, btc: 0, roi: 0 };
        groups[t.pair].trades++;
        groups[t.pair].btc += t.btcResult;
        groups[t.pair].roi += t.roi;
        if (t.btcResult > 0) groups[t.pair].wins++;
      });

      Object.keys(groups).forEach(p => {
        const g = groups[p];
        const avg = g.roi / g.trades;
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${p}</td>
          <td>${g.trades}</td>
          <td>${g.wins}</td>
          <td class="${g.btc >= 0 ? "tag-win" : "tag-loss"}">${formatNumber(g.btc)}</td>
          <td class="${avg >= 0 ? "tag-win" : "tag-loss"}">${formatPercent(avg)}</td>
        `;
        table.appendChild(row);
      });

      if (!Object.keys(groups).length) {
        const row = document.createElement("tr");
        row.innerHTML = `<td colspan="5" style="text-align:center; color:#6b7280;">No trades</td>`;
        table.appendChild(row);
      }
    }

    // ðŸ”µ BANK CHART
    function renderBankChart() {
      const c = document.getElementById("bankChart");
      const ctx = c.getContext("2d");
      const history = loadBankHistory();

      ctx.clearRect(0, 0, c.width, c.height);

      if (!history.length) return;

      const values = history.map(h => h.value);
      const min = Math.min(...values);
      const max = Math.max(...values);
      const range = max - min || 1;

      ctx.strokeStyle = "#22c55e";
      ctx.lineWidth = 2;
      ctx.beginPath();

      values.forEach((v, i) => {
        const x = (i / (values.length - 1)) * c.width;
        const y = c.height - ((v - min) / range) * c.height;
        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
      });

      ctx.stroke();
    }

    // ðŸ”µ FORM SUBMIT
    document.getElementById("tradeForm").addEventListener("submit", e => {
      e.preventDefault();

      const dateStr = document.getElementById("data").value.trim();
      if (!/^\d{2}\/\d{2}\/\d{4}$/.test(dateStr)) {
        alert("Date must be in DD/MM/YYYY format.");
        return;
      }

      const pair = document.getElementById("par").value.trim();
      const qty = parseFloat(document.getElementById("quantidadeAlt").value);
      const entry = parseFloat(document.getElementById("precoEntrada").value);
      const exit = parseFloat(document.getElementById("precoSaida").value);
      const fee = parseFloat(document.getElementById("taxaBtc").value || 0);

      const btcIn = qty * entry;
      const btcOut = qty * exit;
      const btcResult = btcOut - btcIn - fee;
      const roi = btcIn ? (btcResult / btcIn) * 100 : 0;

      const trades = loadTrades();
      trades.push({
        date: dateStr,
        pair,
        qty,
        entry,
        exit,
        btcIn,
        btcOut,
        btcResult,
        roi
      });

      saveTrades(trades);
      renderTrades();
      e.target.reset();
    });

    document.getElementById("btnSalvarBanca").addEventListener("click", () => {
      const v = parseFloat(document.getElementById("bancaInicial").value);
      if (!v || v <= 0) return alert("Enter valid bank value");
      saveBankInitial(v);
      renderTrades();
    });

    document.getElementById("btnToggleChart").addEventListener("click", () => {
      const c = document.getElementById("cardChart");
      c.style.display = c.style.display === "none" ? "block" : "none";
      renderBankChart();
    });

    document.getElementById("btnTogglePairs").addEventListener("click", () => {
      const c = document.getElementById("cardPairs");
      c.style.display = c.style.display === "none" ? "block" : "none";
    });

    renderTrades();
  </script>
</body>
</html>
