<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Satoshis Tracker â€“ Trades par/BTC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="icon-512.png" />
  <link rel="apple-touch-icon" href="icon-512.png" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 16px;
      background: #050816;
      color: #e5e7eb;
    }
    h1 {
      font-size: 1.5rem;
      margin-bottom: 8px;
    }
    .subtitle {
      font-size: 0.85rem;
      color: #9ca3af;
      margin-bottom: 16px;
    }
    .card {
      background: #111827;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
    }
    .card h2 {
      font-size: 1.1rem;
      margin-top: 0;
      margin-bottom: 12px;
    }
    form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      align-items: flex-end;
    }
    label {
      font-size: 0.8rem;
      color: #9ca3af;
      display: block;
      margin-bottom: 4px;
    }
    input, select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
    }
    input:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 1px #22c55e33;
    }
    button {
      padding: 8px 12px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .btn-primary {
      background: #22c55e;
      color: #022c22;
      font-weight: 600;
      width: 100%;
    }
    .btn-primary:hover {
      background: #16a34a;
    }
    .btn-danger {
      background: #ef4444;
      color: white;
    }
    .summary {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      font-size: 0.85rem;
    }
    .summary-item {
      padding: 8px 12px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #1f2937;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
      margin-top: 12px;
    }
    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid #1f2937;
      text-align: right;
      white-space: nowrap;
    }
    th {
      text-align: center;
      background: #020617;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    th:first-child, td:first-child {
      text-align: left;
    }
    tr:nth-child(even) td {
      background: #020617;
    }
    .tag-win { color: #22c55e; font-weight: 600; }
    .tag-loss { color: #f97316; font-weight: 600; }
    .row-actions button {
      font-size: 0.7rem;
      padding: 4px 8px;
      border-radius: 999px;
    }
    .footer {
      margin-top: 16px;
      font-size: 0.75rem;
      color: #6b7280;
      text-align: center;
    }

    /* linha para banca inicial */
    .bank-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 12px;
    }
    .bank-row label {
      margin-bottom: 0;
    }
    .bank-row input {
      max-width: 180px;
    }
    .bank-row .btn-primary {
      width: auto;
      padding-inline: 12px;
    }

    /* wrapper da tabela para scroll horizontal se precisar */
    .table-wrapper {
      width: 100%;
      overflow-x: auto;
    }

    /* Ajustes para telas pequenas (celular) */
    @media (max-width: 640px) {
      body {
        padding: 8px;
      }
      .card {
        padding: 12px;
      }
      table {
        font-size: 0.7rem;
      }
      /* Esconde BTC In (coluna 6) e BTC Out (coluna 7) no mobile */
      th:nth-child(6), td:nth-child(6),
      th:nth-child(7), td:nth-child(7) {
        display: none;
      }
    }
  </style>
</head>
<body>
  <h1>Satoshis Tracker â€“ Trades par/BTC</h1>
  <div class="subtitle">
    Registre seus trades em pares contra BTC e acompanhe o lucro em satoshis.
  </div>

  <div class="card">
    <h2>Novo trade</h2>
    <form id="tradeForm">
      <div>
        <label for="data">Data</label>
        <input type="date" id="data" required />
      </div>
      <div>
        <label for="par">Par</label>
        <input type="text" id="par" placeholder="Ex: XRP/BTC" required />
      </div>
      <div>
        <label for="quantidadeAlt">Quantidade (alt)</label>
        <input type="number" step="0.00000001" id="quantidadeAlt" required />
      </div>
      <div>
        <label for="precoEntrada">PreÃ§o entrada (BTC)</label>
        <input type="number" step="0.00000001" id="precoEntrada" required />
      </div>
      <div>
        <label for="precoSaida">PreÃ§o saÃ­da (BTC)</label>
        <input type="number" step="0.00000001" id="precoSaida" required />
      </div>
      <div>
        <label for="taxaBtc">Taxa (BTC) [opcional]</label>
        <input type="number" step="0.00000001" id="taxaBtc" placeholder="0 se paga em BNB" />
      </div>
      <div>
        <button type="submit" class="btn-primary">Adicionar trade</button>
      </div>
    </form>
  </div>

  <div class="card">
    <h2>Resumo</h2>

    <div class="bank-row">
      <label for="bancaInicial">Banca inicial (BTC):</label>
      <input type="number" id="bancaInicial" step="0.00000001" placeholder="ex: 0.0025" />
      <button type="button" class="btn-primary" id="btnSalvarBanca">Salvar</button>
    </div>

    <div class="summary">
      <div class="summary-item" id="sumTotalTrades">Trades: 0</div>
      <div class="summary-item" id="sumWins">Win rate: 0%</div>
      <div class="summary-item" id="sumBtcResult">Resultado BTC: 0</div>
      <div class="summary-item" id="sumAvgRoi">ROI mÃ©dio: 0%</div>
      <div class="summary-item" id="sumBankInitial">Banca inicial: â€”</div>
      <div class="summary-item" id="sumBankCurrent">Banca atual: â€”</div>
      <div class="summary-item" id="sumBankGrowth">Crescimento: â€”</div>
    </div>
  </div>

  <div class="card">
    <h2>HistÃ³rico de trades</h2>
    <div class="table-wrapper">
      <table id="tradesTable">
        <thead>
          <tr>
            <th>Data</th>
            <th>Par</th>
            <th>Qtd</th>
            <th>Entrada (BTC)</th>
            <th>SaÃ­da (BTC)</th>
            <th>BTC In</th>
            <th>BTC Out</th>
            <th>BTC Resultado</th>
            <th>ROI %</th>
            <th>AÃ§Ãµes</th>
          </tr>
        </thead>
        <tbody>
          <!-- linhas serÃ£o inseridas via JS -->
        </tbody>
      </table>
    </div>
  </div>

  <div class="footer">
    Dados salvos localmente (localStorage). VocÃª estÃ¡ farmando satoshis. ðŸš€
  </div>

  <script>
    const STORAGE_KEY = "btcPairTrades";
    const BANK_KEY = "btcBankInitial";

    function loadTrades() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch (e) {
        console.error("Erro ao carregar trades:", e);
        return [];
      }
    }

    function saveTrades(trades) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(trades));
    }

    function loadBankInitial() {
      try {
        const raw = localStorage.getItem(BANK_KEY);
        const val = raw ? parseFloat(raw) : 0;
        return isNaN(val) ? 0 : val;
      } catch (e) {
        console.error("Erro ao carregar banca:", e);
        return 0;
      }
    }

    function saveBankInitial(value) {
      localStorage.setItem(BANK_KEY, String(value));
    }

    function formatNumber(value, decimals = 8) {
      return Number(value).toFixed(decimals);
    }

    function formatPercent(value) {
      return (Number(value).toFixed(2)) + "%";
    }

    function updateBankSummary(totalBtcResult) {
      const banca = loadBankInitial();
      const input = document.getElementById("bancaInicial");
      const elInit = document.getElementById("sumBankInitial");
      const elCurr = document.getElementById("sumBankCurrent");
      const elGrowth = document.getElementById("sumBankGrowth");

      if (input && banca) {
        input.value = banca.toFixed(8);
      }

      if (!elInit || !elCurr || !elGrowth) return;

      if (!banca) {
        elInit.textContent = "Banca inicial: â€”";
        elCurr.textContent = "Banca atual: â€”";
        elGrowth.textContent = "Crescimento: â€”";
        return;
      }

      const bancaAtual = banca + totalBtcResult;
      const growth = banca ? (totalBtcResult / banca) * 100 : 0;

      elInit.textContent = "Banca inicial: " + banca.toFixed(8);
      elCurr.textContent = "Banca atual: " + bancaAtual.toFixed(8);
      elGrowth.textContent = "Crescimento: " + growth.toFixed(2) + "%";
    }

    function renderTrades() {
      const trades = loadTrades();
      const tbody = document.querySelector("#tradesTable tbody");
      tbody.innerHTML = "";

      let totalBtcResult = 0;
      let wins = 0;

      trades.forEach((t, index) => {
        totalBtcResult += t.btcResultado;
        if (t.btcResultado > 0) wins++;

        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${t.data}</td>
          <td>${t.par}</td>
          <td>${formatNumber(t.quantidadeAlt, 4)}</td>
          <td>${formatNumber(t.precoEntrada)}</td>
          <td>${formatNumber(t.precoSaida)}</td>
          <td>${formatNumber(t.btcEntrada)}</td>
          <td>${formatNumber(t.btcSaida)}</td>
          <td class="${t.btcResultado >= 0 ? "tag-win" : "tag-loss"}">
            ${formatNumber(t.btcResultado)}
          </td>
          <td class="${t.roiPercent >= 0 ? "tag-win" : "tag-loss"}">
            ${formatPercent(t.roiPercent)}
          </td>
          <td class="row-actions">
            <button class="btn-danger" data-index="${index}">Excluir</button>
          </td>
        `;

        tbody.appendChild(tr);
      });

      const totalTrades = trades.length;
      const winRate = totalTrades ? (wins / totalTrades) * 100 : 0;
      const avgRoi = totalTrades
        ? trades.reduce((acc, t) => acc + t.roiPercent, 0) / totalTrades
        : 0;

      document.getElementById("sumTotalTrades").textContent =
        `Trades: ${totalTrades}`;
      document.getElementById("sumWins").textContent =
        `Win rate: ${winRate.toFixed(1)}%`;
      document.getElementById("sumBtcResult").textContent =
        `Resultado BTC: ${formatNumber(totalBtcResult)}`;
      document.getElementById("sumAvgRoi").textContent =
        `ROI mÃ©dio: ${avgRoi.toFixed(2)}%`;

      document
        .querySelectorAll("button.btn-danger")
        .forEach(btn => {
          btn.addEventListener("click", () => {
            const idx = Number(btn.dataset.index);
            const updated = loadTrades();
            updated.splice(idx, 1);
            saveTrades(updated);
            renderTrades();
          });
        });

      updateBankSummary(totalBtcResult);
    }

    document.getElementById("tradeForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const data = document.getElementById("data").value || new Date().toISOString().slice(0,10);
      const par = document.getElementById("par").value.trim();
      const quantidadeAlt = parseFloat(document.getElementById("quantidadeAlt").value);
      const precoEntrada = parseFloat(document.getElementById("precoEntrada").value);
      const precoSaida = parseFloat(document.getElementById("precoSaida").value);
      const taxaBtc = parseFloat(document.getElementById("taxaBtc").value || "0");

      if (!par || isNaN(quantidadeAlt) || isNaN(precoEntrada) || isNaN(precoSaida)) {
        alert("Preencha todos os campos obrigatÃ³rios.");
        return;
      }

      const btcEntrada = quantidadeAlt * precoEntrada;
      const btcSaida = quantidadeAlt * precoSaida;
      const btcResultado = btcSaida - btcEntrada - taxaBtc;
      const roiPercent = btcEntrada !== 0
        ? (btcResultado / btcEntrada) * 100
        : 0;

      const trades = loadTrades();
      trades.push({
        data,
        par,
        quantidadeAlt,
        precoEntrada,
        precoSaida,
        taxaBtc,
        btcEntrada,
        btcSaida,
        btcResultado,
        roiPercent,
      });
      saveTrades(trades);
      renderTrades();
      e.target.reset();
      document.getElementById("data").value = data;
    });

    const btnSalvarBanca = document.getElementById("btnSalvarBanca");
    if (btnSalvarBanca) {
      btnSalvarBanca.addEventListener("click", () => {
        const input = document.getElementById("bancaInicial");
        const val = parseFloat(input.value);
        if (isNaN(val) || val <= 0) {
          alert("Informe um valor de banca inicial em BTC maior que zero.");
          return;
        }
        saveBankInitial(val);
        renderTrades();
      });
    }

    document.getElementById("data").value = new Date().toISOString().slice(0,10);
    renderTrades();
  </script>
</body>
</html>
